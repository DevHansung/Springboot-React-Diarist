프로젝트 소개  
=============
#### Spring Boot + ReactJS 커뮤니티 앱
#### 실행 영상: https://youtu.be/JHhuUx7hnj8
 

설명
====
### 1. 개발환경  
* backend: SpringBoot_ver_2.0  
* frontdne: ReactJs  
* security: SpringSecutiry, JwtTokenLogin(RefreshToken을 이용하여 이중 보안)  
* DataBase: MySQL_ver_8.0.17  
* 기타 라이브러리: AntDesign, JPA-Hibernate  

### 2. 개발기간
* 15일 (2020.04.12~2020.04.26)  

### 3. 개발인원
* 1명(본인) 개인 프로젝트  

### 4. 기획 의도  
   * 풀스택 개발 사이클을 경험 해 보며 동시에 자바스크립트의 es6문법에 익숙해질겸  
   자바스크립트 프론트앤드 라이브러리인 React를 사용하여 본 프로젝트를 기획, 개발하게 되었다.  
   개인 프로젝트로 진행한 이유는 풀스택 개발의 방식과 과정, 개발 자체의 애로사항을 직접 느껴보기 위해서   
   1인프로젝트로 기획하여 개발을 진행하게 되었으며 RestAPI방식으로 개발하고자 노력 하였다.  
   프로젝트를 진행하며 문제가 발생하면 구글링과 관련서적을 찾아보고 코드에 적용 시키며 문제를 해결하였고,  
   개발 과정에서 학습이 필요하다 사료되는 부분을 찾아보며 코드에 적용시키는 과정을 거치면서  
   기획했던대로 모양새가 나오는것을 보면 뿌듯했다 자료를 찾아보는 과정속에서 문제 해결에 불필요한  
   자료들도 많았지만 좋은 자료라고 생각되면 천천히 다 읽어봤는데 덕분에 개발 상식이 늘어난것 같다.  
   아쉬운점은  
   기능적으로는 기획했던대로 어느정도 구현을 하였지만 단기간에 개발을 진행하다보니  
   디테일이 조금 떨어지는것 같다. 이부분은 향후 보완 하도록 할 것이다.  
  
### 5. 동작 설명
   * 기능별 상세 설명은 실행 영상 참조-> https://youtu.be/JHhuUx7hnj8  

### 6. 기능

   * 각각 기능에 해당하는 모든 데이터는 DataBase Table에 저장된다.  
   권한은 최고관리자, 일반관리자, 일반유저, 게스트로 나뉨(필요에 따라 관리자 권한 더 세분화 가능,  
   user테이블과 role테이블을 생성하고 ManyToMany 관계로  
   중간에 user_roles테이블을 둬서 확장성 있게 유저 권한 관리)  
   최고관리자는 관리자의 권한을 컨트롤 할 수 있다.  
   이 외의 관리자 기능은 최고관리자와 일반 관리자가 동일하다.  

   * 게시판  
    게시판 생성: 운영자는 게시판을 생성하고 삭제할 수 있음  
    게시글: 게시글 crud  
    공지사항은 운영자만 작성 가능하고, 일반유저는 작성할 수 없음  
    일반유저는 공지사항이 아닌 게시판만 작성 가능  
    추천: 유저1명당 동일 게시글 1회 추천, 한번 더 누르면 추천 취소  
    댓글: 댓글 crud  
    스크랩: 게시물 스크랩버튼을 누르면 mypage에 저장, 한번 더 누르면 스크랩 취소, mypage에서도 취소할수 있음  
    조회수: 게시물 조회수가 유저 1명당 1회만 조회수가 올라가도록 db table을 한개 생성하여 관리  

   * 이벤트  
    이벤트 등록: 관리자만 이벤트를 등록할 수 있다, 사진첨부 가능  
    이벤트 관리: 이벤트를 crud가능  
    이벤트 접수자 목록 보기: 현재 이벤트에 접수한 유저의 목록을 실시간으로 볼 수 있으며 엑셀파일로 다운로드 가능  
    이벤트 접수: 회원은 개인정보를 입력 후 이벤트 접수를 할 수 있다.  
  
   * 팔로우  
    팔로우: 회원 아이디를 클릭하면 회원 프로필페이지가 로딩된다. 회원 프로필에서 팔로우 버튼을 누르면 mypage에서  
    팔로우 중인 회원을 볼 수 있으며 회원의 프로필과 연결되고 회원이 올린 게시물을 볼 수 있다.(구독과 같은 기능)  
    팔로우 취소는 팔로우 버튼을 한번 더 클릭하거나 mypage에서 팔로우 취소가 가능하다.  

   -TodoList  
    TodoList: 일반유저 전용 기능으로 할일 생성 삭제 완료표시 가능  


### 7. JWT Token 관련  
* jwt토큰 로그인  
  * AccessToken: 유효기간 40분  
  * RefreshToken: 유효기간 2주  
  * 토큰 저장공간: SessionStorage  
  * 토큰 관리: 서버측에서의 토큰 관리는 refresh_token테이블과 token_blacklist테이블에 넣어서 관리  

* 설명  
   * 엑세스토큰은 매 요청시 request header에 포함하여 서버측으로 전송,  
   서버측에서 유효성 검사 후 문제가 없다면 요청 수행 만료되었거나 변조되었다면 error message return   
   리프레시토큰은 단순히 엑세스토큰을 재발급 받는 key이다.  

   * 로그인 -> db의 리프레시 토큰 테이블에 토큰 정보 저장&&갱신(기존값이 있다면 지우고 새로운 값 덮어쓰기)  
   * 로그아웃 -> db에 리프레시토큰 테이블의 토큰을 지우고 블랙리스트 테이블에 리프레시토큰 추가  

   * 엑세스토큰을 발급받는 컨트롤러에서 리프레시토큰이  
   위, 변조되지 않았고 유효기한이 만료되지 않았으며 블랙리스트 테이블에 존재하지 않아야 한다는  
   조건문을 통과해야 엑세스토큰이 새로 발급 됨.  
   이 경우를 제외하고 전부 로그아웃 처리  

* 부가설명  
   * 클라이언트 측에서의 토큰 저장공간에 대하여  
   SessionStorage는 브라우저를 종료하거나 탭을 닫으면 값이 초기화됨  
   LocalStorage는 브라우저를 종료하거나 탭을 닫아도 값이 반영구적으로 유지됨  
   Token로그인 방식의 특성상 토큰이 탈취되는 등 보안성 측면에서 고질적인 이슈가 있기에  
   SessionStorage 사용이 보안적인 측면에서 더 좋은 방안인것 같음.  

* 서비스를 이용하다 엑세스 토큰 만료 상황 발생 시뮬레이션  

   -> 클라이언트측에서 엑세스 토큰의 유효기한을 검증 후  
      5분 이내로 남았다면 서버로 리프레시 토큰을 보내 로그인 갱신 요청을 보냄
      
   -> 서버측에서는 requestBody에 담겨져 넘어온 리프레시토큰을 이용하여 엑세스 토큰을 발급 받는다  
       서버측 리프레시 토큰 발급 과정  
       *3단계의 조건 검사가 진행되며 각 조건문을 통과하지 못할시 error message return와 함께 즉시 로그아웃 처리
       
       1. 파라미터값으로 넘어온 토큰이 db의 리프레시토큰 테이블에 존재하고  
           블랙리스트 테이블에 존재하지 않는지 확인 두 조건을 통과해야 다음단계로 넘어감.  
       2. 위의 조건을 통과했다면 리프레시토큰이 만료되거나 변조된것은 아닌지 유효성 검사 실행  
          유효성 검사를 통과하면 user정보의 기본키인 userid를 반환  
       3. userid로 user테이블에 쿼리를 날려 username을 가져옴  
       4. username을 가지고 새로운 엑세스 토큰을 발급하여 기존의   
          리프레시 토큰과 함께 클라이언트 측으로 response를 보낸다.  
          
   -> 위의 과정 통과 시 클라이언트측은 서버측으로부터 success message와 함께 리프레시 토큰과 엑세스 토큰을  
      넘겨받게 되며 리프레시토큰과 엑세스토큰을 SessionStorage에 저장하고 로그인을 유지한다.


실행 방법  
========
  * Backend  
     a. application.properties 의 DB연동 설정을 참고하여 DB생성  
     b. 이클립스 사용  
         
         diaristBackend폴더 import  
         -> 프로젝트 마우스 우클릭   
         -> Run As  
         -> Spring Boot App 클릭  

   * Frontend  
      a. VSCode사용  
         * diaristFrontend 디렉토리로 이동하여 아래 명령어 실행   
           
           -> yarn start && npm start  


### 기능별 상세 설명은 실행 영상 참조: https://youtu.be/JHhuUx7hnj8
